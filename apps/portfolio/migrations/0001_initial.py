# Generated by Django 5.2.4 on 2025-07-26 11:29

import django.db.models.deletion
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('market_data_service', '0001_initial'),
    ]

    operations = [
        migrations.CreateModel(
            name='TradingAccount',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('account_name', models.CharField(max_length=100)),
                ('broker', models.CharField(default='fyers', max_length=50)),
                ('account_id', models.CharField(max_length=100, unique=True)),
                ('is_active', models.BooleanField(default=True)),
                ('is_paper_trading', models.BooleanField(default=True)),
                ('account_type', models.CharField(choices=[('EQUITY', 'Equity Trading'), ('DERIVATIVES', 'Derivatives Trading'), ('COMMODITY', 'Commodity Trading'), ('MULTI_ASSET', 'Multi-Asset')], default='EQUITY', max_length=20)),
                ('initial_capital', models.DecimalField(decimal_places=2, max_digits=15)),
                ('current_capital', models.DecimalField(decimal_places=2, max_digits=15)),
                ('available_margin', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('blocked_margin', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('realized_pnl', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('unrealized_pnl', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('max_position_size_pct', models.DecimalField(decimal_places=2, default=5.0, max_digits=5)),
                ('max_portfolio_risk_pct', models.DecimalField(decimal_places=2, default=2.0, max_digits=5)),
                ('stop_loss_pct', models.DecimalField(decimal_places=2, default=5.0, max_digits=5)),
                ('max_daily_trades', models.IntegerField(default=10)),
                ('max_positions', models.IntegerField(default=20)),
                ('leverage_ratio', models.DecimalField(decimal_places=1, default=1.0, max_digits=3)),
                ('total_trades', models.IntegerField(default=0)),
                ('winning_trades', models.IntegerField(default=0)),
                ('losing_trades', models.IntegerField(default=0)),
                ('total_pnl', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('best_trade_pnl', models.DecimalField(decimal_places=2, max_digits=15, null=True)),
                ('worst_trade_pnl', models.DecimalField(decimal_places=2, max_digits=15, null=True)),
                ('average_trade_pnl', models.DecimalField(decimal_places=2, max_digits=10, null=True)),
                ('max_consecutive_wins', models.IntegerField(default=0)),
                ('max_consecutive_losses', models.IntegerField(default=0)),
                ('current_streak', models.IntegerField(default=0)),
                ('max_drawdown', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('max_drawdown_pct', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('current_drawdown', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('primary_strategy', models.CharField(default='EFI_CROSSOVER', max_length=50)),
                ('strategy_performance', models.JSONField(default=dict)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'db_table': 'trading_accounts',
                'indexes': [models.Index(fields=['account_id'], name='trading_acc_account_bd9bc9_idx'), models.Index(fields=['is_active', 'account_type'], name='trading_acc_is_acti_6c0ec9_idx'), models.Index(fields=['broker'], name='trading_acc_broker_122b91_idx'), models.Index(fields=['total_pnl'], name='trading_acc_total_p_eed62b_idx')],
            },
        ),
        migrations.CreateModel(
            name='Portfolio',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('quantity', models.IntegerField()),
                ('average_price', models.DecimalField(decimal_places=2, max_digits=10)),
                ('current_price', models.DecimalField(decimal_places=2, max_digits=10)),
                ('market_value', models.DecimalField(decimal_places=2, max_digits=15)),
                ('cost_basis', models.DecimalField(decimal_places=2, max_digits=15)),
                ('unrealized_pnl', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('unrealized_pnl_pct', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('realized_pnl', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('total_pnl', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('position_type', models.CharField(choices=[('LONG', 'Long'), ('SHORT', 'Short')], default='LONG', max_length=10)),
                ('position_status', models.CharField(choices=[('OPEN', 'Open'), ('PARTIAL_CLOSE', 'Partially Closed'), ('CLOSED', 'Closed'), ('SUSPENDED', 'Suspended')], default='OPEN', max_length=15)),
                ('stop_loss_price', models.DecimalField(decimal_places=2, max_digits=10, null=True)),
                ('target_price', models.DecimalField(decimal_places=2, max_digits=10, null=True)),
                ('trailing_stop_price', models.DecimalField(decimal_places=2, max_digits=10, null=True)),
                ('trailing_stop_pct', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('max_loss_amount', models.DecimalField(decimal_places=2, max_digits=10, null=True)),
                ('position_value', models.DecimalField(decimal_places=2, max_digits=15)),
                ('portfolio_weight_pct', models.DecimalField(decimal_places=2, max_digits=5)),
                ('position_risk_score', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('beta', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('correlation_to_portfolio', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('days_held', models.IntegerField(default=0)),
                ('high_since_entry', models.DecimalField(decimal_places=2, max_digits=10, null=True)),
                ('low_since_entry', models.DecimalField(decimal_places=2, max_digits=10, null=True)),
                ('max_unrealized_gain', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('max_unrealized_loss', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('entry_date', models.DateTimeField()),
                ('last_price_update', models.DateTimeField(auto_now=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='market_data_service.company')),
                ('entry_signal', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='portfolio_positions', to='market_data_service.tradingsignal')),
                ('exit_signal', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='portfolio_exits', to='market_data_service.tradingsignal')),
                ('account', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='portfolio.tradingaccount')),
            ],
            options={
                'db_table': 'portfolio_positions',
            },
        ),
        migrations.CreateModel(
            name='Trade',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('trade_type', models.CharField(choices=[('BUY', 'Buy'), ('SELL', 'Sell')], max_length=10)),
                ('order_type', models.CharField(choices=[('MARKET', 'Market Order'), ('LIMIT', 'Limit Order'), ('STOP_LOSS', 'Stop Loss'), ('STOP_LIMIT', 'Stop Limit')], default='MARKET', max_length=15)),
                ('quantity', models.IntegerField()),
                ('price', models.DecimalField(decimal_places=2, max_digits=10)),
                ('total_value', models.DecimalField(decimal_places=2, max_digits=15)),
                ('limit_price', models.DecimalField(decimal_places=2, max_digits=10, null=True)),
                ('stop_price', models.DecimalField(decimal_places=2, max_digits=10, null=True)),
                ('validity', models.CharField(choices=[('DAY', 'Day'), ('IOC', 'Immediate or Cancel'), ('GTD', 'Good Till Date')], default='DAY', max_length=10)),
                ('valid_till', models.DateTimeField(blank=True, null=True)),
                ('order_id', models.CharField(blank=True, max_length=100, null=True)),
                ('status', models.CharField(choices=[('PENDING', 'Pending'), ('EXECUTED', 'Executed'), ('CANCELLED', 'Cancelled'), ('REJECTED', 'Rejected'), ('PARTIAL', 'Partially Executed')], default='PENDING', max_length=10)),
                ('executed_price', models.DecimalField(decimal_places=2, max_digits=10, null=True)),
                ('executed_quantity', models.IntegerField(null=True)),
                ('remaining_quantity', models.IntegerField(default=0)),
                ('avg_execution_price', models.DecimalField(decimal_places=2, max_digits=10, null=True)),
                ('execution_count', models.IntegerField(default=0)),
                ('brokerage', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('taxes', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('total_charges', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('stt', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('stamp_duty', models.DecimalField(decimal_places=2, default=0, max_digits=8)),
                ('exchange_charges', models.DecimalField(decimal_places=2, default=0, max_digits=8)),
                ('gst', models.DecimalField(decimal_places=2, default=0, max_digits=8)),
                ('trade_reason', models.CharField(blank=True, choices=[('SIGNAL_ENTRY', 'Signal Entry'), ('SIGNAL_EXIT', 'Signal Exit'), ('STOP_LOSS', 'Stop Loss'), ('TARGET_HIT', 'Target Hit'), ('RISK_MGMT', 'Risk Management'), ('MANUAL', 'Manual Trade')], max_length=20, null=True)),
                ('trade_metadata', models.JSONField(default=dict)),
                ('market_condition', models.CharField(blank=True, max_length=15)),
                ('order_time', models.DateTimeField(auto_now_add=True)),
                ('execution_time', models.DateTimeField(blank=True, null=True)),
                ('cancellation_time', models.DateTimeField(blank=True, null=True)),
                ('slippage', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('execution_delay_seconds', models.IntegerField(null=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='market_data_service.company')),
                ('portfolio_position', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='portfolio.portfolio')),
                ('trading_signal', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='market_data_service.tradingsignal')),
                ('account', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='portfolio.tradingaccount')),
            ],
            options={
                'db_table': 'trades',
                'indexes': [models.Index(fields=['account', 'trade_type'], name='trades_account_6e9a4a_idx'), models.Index(fields=['status', 'order_type'], name='trades_status_46b7c9_idx'), models.Index(fields=['order_time'], name='trades_order_t_5b951d_idx'), models.Index(fields=['execution_time'], name='trades_executi_52db81_idx'), models.Index(fields=['company', 'trade_type'], name='trades_company_50f236_idx'), models.Index(fields=['trade_reason'], name='trades_trade_r_1f316e_idx')],
            },
        ),
        migrations.CreateModel(
            name='RiskManagement',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('max_position_size', models.DecimalField(decimal_places=2, max_digits=15)),
                ('max_sector_exposure_pct', models.DecimalField(decimal_places=2, default=20.0, max_digits=5)),
                ('max_stock_exposure_pct', models.DecimalField(decimal_places=2, default=10.0, max_digits=5)),
                ('max_correlation', models.DecimalField(decimal_places=2, default=0.8, max_digits=3)),
                ('max_beta', models.DecimalField(decimal_places=2, default=1.5, max_digits=3)),
                ('min_liquidity_score', models.DecimalField(decimal_places=2, default=0.7, max_digits=3)),
                ('max_daily_loss', models.DecimalField(decimal_places=2, max_digits=15)),
                ('max_drawdown_pct', models.DecimalField(decimal_places=2, default=10.0, max_digits=5)),
                ('max_var_pct', models.DecimalField(decimal_places=2, default=5.0, max_digits=5)),
                ('max_leverage', models.DecimalField(decimal_places=1, default=2.0, max_digits=3)),
                ('concentration_limit_pct', models.DecimalField(decimal_places=2, default=15.0, max_digits=5)),
                ('auto_stop_loss', models.BooleanField(default=True)),
                ('trailing_stop_pct', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('auto_rebalance', models.BooleanField(default=False)),
                ('rebalance_threshold_pct', models.DecimalField(decimal_places=2, default=5.0, max_digits=5)),
                ('current_risk_score', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('last_risk_check', models.DateTimeField(blank=True, null=True)),
                ('breach_count_daily', models.IntegerField(default=0)),
                ('breach_count_monthly', models.IntegerField(default=0)),
                ('last_breach_date', models.DateField(blank=True, null=True)),
                ('risk_alert_threshold', models.DecimalField(decimal_places=2, default=80.0, max_digits=5)),
                ('send_alerts', models.BooleanField(default=True)),
                ('alert_channels', models.JSONField(default=list)),
                ('escalation_levels', models.JSONField(default=dict)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('account', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='portfolio.tradingaccount')),
            ],
            options={
                'db_table': 'risk_management',
                'indexes': [models.Index(fields=['current_risk_score'], name='risk_manage_current_a91380_idx'), models.Index(fields=['last_risk_check'], name='risk_manage_last_ri_0d9787_idx'), models.Index(fields=['breach_count_daily'], name='risk_manage_breach__152f83_idx')],
            },
        ),
        migrations.CreateModel(
            name='PortfolioSnapshot',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('snapshot_date', models.DateField()),
                ('total_value', models.DecimalField(decimal_places=2, max_digits=15)),
                ('cash_balance', models.DecimalField(decimal_places=2, max_digits=15)),
                ('invested_amount', models.DecimalField(decimal_places=2, max_digits=15)),
                ('margin_used', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('margin_available', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('exposure', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('day_pnl', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('day_pnl_pct', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('total_pnl', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('total_return_pct', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('realized_pnl', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('unrealized_pnl', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('portfolio_beta', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('max_drawdown_pct', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('volatility', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('var_1d', models.DecimalField(decimal_places=2, max_digits=15, null=True)),
                ('portfolio_concentration', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('correlation_risk', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('holdings_data', models.JSONField(default=dict)),
                ('sector_allocation', models.JSONField(default=dict)),
                ('market_index_value', models.DecimalField(decimal_places=2, max_digits=10, null=True)),
                ('market_index_change', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('account', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='portfolio.tradingaccount')),
            ],
            options={
                'db_table': 'portfolio_snapshots',
                'indexes': [models.Index(fields=['snapshot_date'], name='portfolio_s_snapsho_ed5790_idx'), models.Index(fields=['total_return_pct'], name='portfolio_s_total_r_636bcc_idx'), models.Index(fields=['max_drawdown_pct'], name='portfolio_s_max_dra_b1613b_idx')],
                'unique_together': {('account', 'snapshot_date')},
            },
        ),
        migrations.CreateModel(
            name='PortfolioAnalytics',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('analysis_date', models.DateField()),
                ('sharpe_ratio', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('sortino_ratio', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('information_ratio', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('calmar_ratio', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('treynor_ratio', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('jensen_alpha', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('var_95', models.DecimalField(decimal_places=2, max_digits=15, null=True)),
                ('cvar_95', models.DecimalField(decimal_places=2, max_digits=15, null=True)),
                ('var_99', models.DecimalField(decimal_places=2, max_digits=15, null=True)),
                ('expected_shortfall', models.DecimalField(decimal_places=2, max_digits=15, null=True)),
                ('max_consecutive_losses', models.IntegerField(null=True)),
                ('sector_attribution', models.JSONField(default=dict)),
                ('stock_attribution', models.JSONField(default=dict)),
                ('factor_attribution', models.JSONField(default=dict)),
                ('style_attribution', models.JSONField(default=dict)),
                ('benchmark_return', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('alpha', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('beta', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('tracking_error', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('correlation_to_benchmark', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('up_capture_ratio', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('down_capture_ratio', models.DecimalField(decimal_places=2, max_digits=5, null=True)),
                ('analysis_window_days', models.IntegerField(default=252)),
                ('benchmark_used', models.CharField(default='NIFTY50', max_length=50)),
                ('confidence_level', models.DecimalField(decimal_places=2, default=0.95, max_digits=3)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('account', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='portfolio.tradingaccount')),
            ],
            options={
                'db_table': 'portfolio_analytics',
                'indexes': [models.Index(fields=['analysis_date'], name='portfolio_a_analysi_27c739_idx'), models.Index(fields=['sharpe_ratio'], name='portfolio_a_sharpe__ab226d_idx'), models.Index(fields=['alpha'], name='portfolio_a_alpha_7d8e59_idx'), models.Index(fields=['max_consecutive_losses'], name='portfolio_a_max_con_18463a_idx')],
                'unique_together': {('account', 'analysis_date')},
            },
        ),
        migrations.AddIndex(
            model_name='portfolio',
            index=models.Index(fields=['account', 'position_type', 'position_status'], name='portfolio_p_account_cbb611_idx'),
        ),
        migrations.AddIndex(
            model_name='portfolio',
            index=models.Index(fields=['entry_date'], name='portfolio_p_entry_d_595659_idx'),
        ),
        migrations.AddIndex(
            model_name='portfolio',
            index=models.Index(fields=['unrealized_pnl'], name='portfolio_p_unreali_58adac_idx'),
        ),
        migrations.AddIndex(
            model_name='portfolio',
            index=models.Index(fields=['portfolio_weight_pct'], name='portfolio_p_portfol_128a15_idx'),
        ),
        migrations.AddIndex(
            model_name='portfolio',
            index=models.Index(fields=['position_risk_score'], name='portfolio_p_positio_072c03_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='portfolio',
            unique_together={('account', 'company')},
        ),
    ]
